<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• + ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</title>
  <style>
    /* Global Styles */
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    /* Controls */
    .controls,
    .team-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .controls input {
      flex: 1;
      padding: 6px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button.delete {
      background: #f44336;
    }

    /* Table Wrapper for horizontal scroll */
    .table-wrapper {
      overflow-x: auto;
    }

    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background: #eee;
    }

    /* Plus/Minus Buttons */
    .btn-inc,
    .btn-dec {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
    }
    .btn-inc {
      background: #4CAF50;
    }
    .btn-dec {
      background: #f44336;
    }
    .val {
      display: inline-block;
      width: 24px;
      text-align: center;
      margin: 0 4px;
      font-weight: bold;
    }

    /* Responsive: Card View on small screens */
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead {
        display: none;
      }
      tr {
        margin: 0 0 16px;
        padding: 12px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      }
      td {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border: none;
        position: relative;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
        color: #555;
      }
      .btn-inc,
      .btn-dec {
        width: 32px;
        height: 32px;
        font-size: 18px;
      }
      .val {
        min-width: 28px;
      }
    }

    /* Chat Controls */
    #messageInput {
      flex: 1;
      padding: 6px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #sendMsgBtn {
      padding: 6px 12px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 4px;
    }
    #sendMsgBtn:hover {
      background: #1976D2;
    }
  </style>
</head>
<body>

  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• + ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h1>

  <!-- Controls: ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡∏•‡∏ö ‡∏ó‡∏µ‡∏° -->
  <div class="controls">
    <input type="text" id="teamNameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà" />
    <button id="addTeamBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</button>
    <button id="clearAllBtn">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° -->
  <div id="teamInputsContainer"></div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -->
  <div class="table-wrapper">
    <table id="leagueTable" style="display: none;">
      <thead>
        <tr>
          <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
          <th>‡πÇ‡∏•‡πÇ‡∏Å‡πâ</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</th>
          <th>‡∏ä‡∏ô‡∏∞</th>
          <th>‡πÄ‡∏™‡∏°‡∏≠</th>
          <th>‡πÅ‡∏û‡πâ</th>
          <th>‡πÑ‡∏î‡πâ</th>
          <th>‡πÄ‡∏™‡∏µ‡∏¢</th>
          <th>‡πÑ‡∏î‡πâ-‡πÄ‡∏™‡∏µ‡∏¢</th>
          <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <!-- Chat Controls: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ä‡∏ó -->
  <div class="controls" style="margin-top: 20px;">
    <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." />
    <button id="sendMsgBtn">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
  </div>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    // 1) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase
    const firebaseConfig = {
      apiKey:        "YOUR_API_KEY",
      authDomain:    "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL:   "https://score-point-a4b6b-default-rtdb.firebaseio.com",
      projectId:     "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId:         "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    // 2) ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Realtime DB
    const db          = firebase.database();
    const teamsRef    = db.ref("teams");
    const messagesRef = db.ref("messages");
    let teams = [];

    // 3) ‡∏ü‡∏±‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å DB ‡∏ï‡∏≠‡∏ô value ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
    teamsRef.on("value", snap => {
      const data = snap.val() || {};
      teams = Object.entries(data).map(([id, val]) => ({ id, ...val }));
      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
      teams.forEach((t, idx) => {
        if (!t.logo || !t.logo.trim()) {
          const defLogo = `A${idx+1}.png`;
          teamsRef.child(t.id).update({ logo: defLogo });
          t.logo = defLogo;
        }
      });
      renderTeamInputs();
      renderTable();
    });

    // 4) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà
    async function addTeam() {
      const name = document.getElementById("teamNameInput").value.trim();
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°");
      await teamsRef.push({ name, logo: "", win:0, draw:0, loss:0, gf:0, ga:0 });
      document.getElementById("teamNameInput").value = "";
    }

    // 5) ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°
    async function clearAll() {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        await teamsRef.remove();
      }
    }

    // 6) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏î‡πâ‡∏ß‡∏¢ delta (+/-)
    async function updateField(id, field, delta) {
      const team = teams.find(t => t.id === id);
      if (!team) return;
      let newVal = (team[field] || 0) + delta;
      if (newVal < 0) newVal = 0;
      await teamsRef.child(id).update({ [field]: newVal });
    }

    // 7) ‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    function handleDeleteTeam(e) {
      const id = e.target.dataset.id;
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        teamsRef.child(id).remove();
      }
    }

    // 8) ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
    function renderTeamInputs() {
      const cont = document.getElementById("teamInputsContainer");
      cont.innerHTML = "";
      teams.forEach(t => {
        const row = document.createElement("div");
        row.className = "team-row";
        row.innerHTML = `
          <span class="team-name">${t.name}</span>
          <button class="delete" data-id="${t.id}">‚ùå ‡∏•‡∏ö</button>
        `;
        cont.appendChild(row);
      });
      cont.querySelectorAll("button.delete")
          .forEach(btn => btn.addEventListener("click", handleDeleteTeam));
    }

    // 9) ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏° +/-
    function renderTable() {
      const table = document.getElementById("leagueTable");
      const body  = document.getElementById("tableBody");
      body.innerHTML = "";
      if (teams.length === 0) {
        table.style.display = "none";
        return;
      }

      // ‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô > ‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π > ‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÑ‡∏î‡πâ
      const sorted = [...teams].sort((a,b) => {
        const pa = a.win*3 + a.draw, pb = b.win*3 + b.draw;
        const gda = a.gf - a.ga, gdb = b.gf - b.ga;
        if (pb !== pa) return pb - pa;
        if (gdb !== gda) return gdb - gda;
        return b.gf - a.gf;
      });

      sorted.forEach((t, i) => {
        const pts = t.win*3 + t.draw;
        const gd  = t.gf - t.ga;
        const defLogo = `A${i+1}.png`;
        const logo = t.logo && t.logo.trim() ? t.logo : defLogo;

        body.insertAdjacentHTML("beforeend", `
          <tr>
            <td data-label="‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö">${i+1}</td>
            <td data-label="‡πÇ‡∏•‡πÇ‡∏Å‡πâ">
              <img src="logos/${logo}" alt="${t.name}" width="32" height="32"
                   onerror="this.src='logos/${defLogo}'; this.onerror=null;">
            </td>
            <td data-label="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°">${t.name}</td>
            <td data-label="‡∏ä‡∏ô‡∏∞">
              <button class="btn-dec" data-id="${t.id}" data-field="win">‚Äì</button>
              <span class="val">${t.win}</span>
              <button class="btn-inc" data-id="${t.id}" data-field="win">+</button>
            </td>
            <td data-label="‡πÄ‡∏™‡∏°‡∏≠">
              <button class="btn-dec" data-id="${t.id}" data-field="draw">‚Äì</button>
              <span class="val">${t.draw}</span>
              <button class="btn-inc" data-id="${t.id}" data-field="draw">+</button>
            </td>
            <td data-label="‡πÅ‡∏û‡πâ">
              <button class="btn-dec" data-id="${t.id}" data-field="loss">‚Äì</button>
              <span class="val">${t.loss}</span>
              <button class="btn-inc" data-id="${t.id}" data-field="loss">+</button>
            </td>
            <td data-label="‡πÑ‡∏î‡πâ">
              <button class="btn-dec" data-id="${t.id}" data-field="gf">‚Äì</button>
              <span class="val">${t.gf}</span>
              <button class="btn-inc" data-id="${t.id}" data-field="gf">+</button>
            </td>
            <td data-label="‡πÄ‡∏™‡∏µ‡∏¢">
              <button class="btn-dec" data-id="${t.id}" data-field="ga">‚Äì</button>
              <span class="val">${t.ga}</span>
              <button class="btn-inc" data-id="${t.id}" data-field="ga">+</button>
            </td>
            <td data-label="‡πÑ‡∏î‡πâ-‡πÄ‡∏™‡∏µ‡∏¢">${gd}</td>
            <td data-label="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô">${pts}</td>
          </tr>
        `);
      });

      // bind ‡∏õ‡∏∏‡πà‡∏° inc/dec
      body.querySelectorAll(".btn-inc").forEach(btn =>
        btn.addEventListener("click", e => updateField(e.target.dataset.id, e.target.dataset.field, +1))
      );
      body.querySelectorAll(".btn-dec").forEach(btn =>
        btn.addEventListener("click", e => updateField(e.target.dataset.id, e.target.dataset.field, -1))
      );
      table.style.display = "table";
    }

    // 10) ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏û‡∏¥‡πà‡∏°-‡∏•‡πâ‡∏≤‡∏á
    document.getElementById("addTeamBtn").addEventListener("click", addTeam);
    document.getElementById("clearAllBtn").addEventListener("click", clearAll);

    // 11) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    function sendMessage() {
      const inputEl = document.getElementById("messageInput");
      const text = inputEl.value.trim();
      if (!text) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á");

      messagesRef.push({
        text,
        timestamp: Date.now(),
        timeStr: new Date().toLocaleString()
      })
      .then(() => {
        inputEl.value = "";
        console.log("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      })
      .catch(err => {
        console.error("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
      });
    }

    // 12) ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞ Enter key ‡∏Å‡∏±‡∏ö sendMessage
    document.getElementById("sendMsgBtn").addEventListener("click", sendMessage);
    document.getElementById("messageInput").addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>

</body>
</html>
