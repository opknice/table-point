<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    h1 { text-align: center; }

    .controls, .team-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .controls input      { flex: 1; padding: 6px; font-size: 16px; }
    .team-row            { flex-wrap: wrap; }
    .team-row > *        { margin: 2px 0; }
    .team-name           { min-width: 120px; font-weight: bold; }
    .team-row input      { width: 80px; padding: 4px; font-size: 14px; }

    button          { padding: 6px 12px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; }
    button.delete   { background: #f44336; }

    table {
      width: 100%; border-collapse: collapse; margin-top: 20px; background: white;
    }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    th     { background: #eee; }
    td input[type="number"] { width: 60px; padding: 4px; font-size: 14px; }
  </style>
</head>
<body>

  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</h1>

  <!-- ----------- ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡∏•‡∏ö ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ----------- -->
  <div class="controls">
    <input type="text" id="teamNameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà" />
    <button id="addTeamBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°</button>
    <button id="clearAllBtn">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>

  <!-- ----------- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° ----------- -->
  <div id="teamInputsContainer"></div>

  <!-- ----------- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ----------- -->
  <table id="leagueTable" style="display:none;">
    <thead>
      <tr>
        <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
        <th>‡πÇ‡∏•‡πÇ‡∏Å‡πâ</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</th>
        <th>‡∏ä‡∏ô‡∏∞</th>
        <th>‡πÄ‡∏™‡∏°‡∏≠</th>
        <th>‡πÅ‡∏û‡πâ</th>
        <th>‡πÑ‡∏î‡πâ</th>
        <th>‡πÄ‡∏™‡∏µ‡∏¢</th>
        <th>‡πÑ‡∏î‡πâ-‡πÄ‡∏™‡∏µ‡∏¢</th>
        <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <!-- ------------ Firebase SDK (compat) ------------ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    /* 1) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase -------------------------------------------------- */
    const firebaseConfig = {
      apiKey:        "YOUR_API_KEY",
      authDomain:    "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL:   "https://score-point-a4b6b-default-rtdb.firebaseio.com",
      projectId:     "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId:             "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    /* 2) ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Realtime DB --------------------------------------------- */
    const db       = firebase.database();
    const teamsRef = db.ref("teams");

    let teams = [];

    /* 3) ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• & ‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ default ------------------------------------ */
    teamsRef.on("value", snap => {
      const data = snap.val() || {};
      teams = Object.keys(data).map(key => ({
        id:   key,
        ...data[key]   // name, logo, win, draw, loss, gf, ga
      }));

      teams.forEach((t, idx) => {
        if (!t.logo || t.logo.trim() === "") {
          const def = `A${idx + 1}.png`;
          teamsRef.child(t.id).update({ logo: def });
          t.logo = def;
        }
      });

      renderTeamInputs();
      renderTable();
    });

    /* 4) ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà ------------------------------------------------------ */
    async function addTeam() {
      const inp = document.getElementById("teamNameInput");
      const name = inp.value.trim();
      if (!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°");
      await teamsRef.push({
        name, logo: "", win: 0, draw: 0, loss: 0,
        gf: 0, ga: 0    // NEW
      });
      inp.value = "";
    }

    /* 5) ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏° -------------------------------------------------------- */
    async function clearAll() {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) await teamsRef.remove();
    }

    /* 6) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å input --------------------------------------------------- */
    function handleInputChange(e) {
      const id    = e.target.dataset.id;
      const field = e.target.dataset.field;
      const val   = ["name","logo"].includes(field)
                      ? e.target.value
                      : parseInt(e.target.value) || 0;
      teamsRef.child(id).update({ [field]: val });
    }

    /* 7) ‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß -------------------------------------------------------- */
    function handleDeleteTeam(e) {
      const id = e.target.dataset.id;
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) teamsRef.child(id).remove();
    }

    /* 8) ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠ ------------------------------------------------------ */
    function renderTeamInputs() {
      const cont = document.getElementById("teamInputsContainer");
      cont.innerHTML = "";
      teams.forEach(t => {
        const row = document.createElement("div");
        row.className = "team-row";
        row.innerHTML = `
          <span class="team-name">${t.name}</span>
          <button class="delete" data-id="${t.id}">‚ùå ‡∏•‡∏ö</button>
        `;
        cont.appendChild(row);
      });
      cont.querySelectorAll("button.delete")
          .forEach(b => b.addEventListener("click", handleDeleteTeam));
    }

    /* 9) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -------------------------------------------------------- */
    function renderTable() {
      const table = document.getElementById("leagueTable");
      const body  = document.getElementById("tableBody");
      body.innerHTML = "";

      if (teams.length === 0) { table.style.display = "none"; return; }

      /* ---- ‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö: ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô > GD > ‡πÑ‡∏î‡πâ ---- */
      const sorted = [...teams].sort((a,b) => {
        const pa = a.win*3 + a.draw;
        const pb = b.win*3 + b.draw;
        const gda = (a.gf - a.ga);
        const gdb = (b.gf - b.ga);
        if (pb !== pa) return pb - pa;
        if (gdb !== gda) return gdb - gda;
        return b.gf - a.gf;
      });

      sorted.forEach((t,i) => {
        const pts = t.win*3 + t.draw;
        const gd  = t.gf - t.ga;
        const defLogo = `A${i + 1}.png`;
        const logo = t.logo && t.logo.trim() !== "" ? t.logo : defLogo;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td><img src="logos/${logo}" alt="${t.name}" style="width:32px;height:32px;"
                   onerror="this.src='logos/${defLogo}'; this.onerror=null;"></td>
          <td>${t.name}</td>

          <td><input type="number" min="0" value="${t.win}"  data-id="${t.id}" data-field="win" /></td>
          <td><input type="number" min="0" value="${t.draw}" data-id="${t.id}" data-field="draw" /></td>
          <td><input type="number" min="0" value="${t.loss}" data-id="${t.id}" data-field="loss" /></td>

          <td><input type="number" min="0" value="${t.gf}"  data-id="${t.id}" data-field="gf" /></td>
          <td><input type="number" min="0" value="${t.ga}"  data-id="${t.id}" data-field="ga" /></td>
          <td>${gd}</td>
          <td>${pts}</td>
        `;
        body.appendChild(tr);
        tr.querySelectorAll("input[type='number']")
           .forEach(inp => inp.addEventListener("input", handleInputChange));
      });

      table.style.display = "table";
    }

    /* 10) bind ‡∏õ‡∏∏‡πà‡∏° -------------------------------------------------------- */
    document.getElementById("addTeamBtn").addEventListener("click", addTeam);
    document.getElementById("clearAllBtn").addEventListener("click", clearAll);
  </script>

</body>
</html>
